# JavaScript-Deobjuscation

## Source Code
### Notes
Source Code
- JavaScript: powers functionality, most websites use JavaScript to handle interactive and functional tasks behind the scenes.
- HTML: defines the structure and fields of a website.
- CSS: controls the visual design and layout.
- Client-side execution: JavaScript runs in the background, creating dynamic experiences, while users only interact with the rendered front-end.
- Source code is accessible, although it's executed on the client side, it's all accessible through the browser.
- Analyzing web pages:
  - To understand how a web page works on the client side, start by reviewing the page’s source code.
  - This helps uncover the logic and features implemented through JavaScript and HTML.

HTML
- Use 'Ctrl + U' to open the source view of the page

CSS
- Definition
  - Internal: will be found in the 'Style' field
  - External: will be in the 'link' tag in the HTML 'Head'

JavaScript
- Definition
  - Internal: will be written in between the 'script' elements
  - External: will be referenced in the 'script' tag
- If a JS code is very complicated and difficult to read, then they might be using deobfuscation
  - This includes code structure, or names of variables

### Walkthrough
Q1.
- Visit the website: http://SERVER_IP:PORT
  - Replace the IP and Port with the one generated by HTB
- Open the source view of the page with 'Ctrl + U'
- The flag will be a comment
- Answer is: HTB{4lw4y5_r34d_7h3_50urc3}

## Code Obfuscation
### Notes
What is Obfuscation?
- Definition:
  - Obfuscation is the process of making code harder for humans to read, while maintaining its original functionality.
  - It may slightly reduce performance due to added complexity.
- How it's done:
  - Typically performed by automated tools.
  - These tools rewrite code using techniques like converting code elements into dictionary references, then rebuilding them at runtime.
- Target languages:
  - Common with interpreted languages (e.g., Python, PHP, JavaScript) that aren’t compiled before execution.
  - Python and PHP are usually server-side (hidden from users), so it's usually not needed
  - JavaScript is client-side, meaning users can view and access it directly—making it a prime candidate for obfuscation.
- Purpose of obfuscation in JavaScript:
  - Prevent users from easily understanding or tampering with the code.
  - Often used to protect intellectual property or conceal malicious behavior.

Use Cases
- Reasons for obfuscation:
  - Code protection: Prevent others from copying or reusing code without permission.
  - Reverse engineering deterrence: Make it harder to analyze or understand the code’s original logic.
  - Security enhancement: Obfuscate sensitive logic related to authentication or encryption.
- Caveat: performing authentication or encryption on the client-side (like in JavaScript) is not recommended, as the code is easily accessible and more vulnerable to attacks.
- Malicious use cases:
  - Attackers frequently use obfuscation to hide the purpose of their scripts.
  - This helps evade Intrusion Detection and Prevention Systems (IDPS).

## Basic Obfuscation
### Notes
- Code obfuscation is typically automated.
- Various tools exist for different programming languages, including many online options.
- Malicious actors and professional developers often create custom obfuscation tools to make deobfuscation harder.

Minifying
- Minification is a technique used to reduce code readability while maintaining full functionality.
- Typically compresses code into a single long line, removing all unnecessary spaces, line breaks, and comments.
- Particularly useful for longer scripts, where it significantly reduces size and improves load performance.
  - For short, single-line code, minification doesn’t make much visible difference.
- Not exclusive to JS, can be applied to other languages
  - Online Tool: https://javascript-minifier.com/
- Usually, minified JS code is saved with the extension .min.js.

Packing
- Packer obfuscation tools convert all words and symbols in code into a list or dictionary.
  - Online Tool: http://beautifytools.com/javascript-obfuscator.php
- These tools then use a (p,a,c,k,e,d) function (or a variant) to reconstruct the original code at runtime.
  - It also defines the order in which elements are unpacked and reassembled.
- While packers effectively reduce readability, they often leave main strings in cleartext, potentially exposing parts of the code’s functionality.
  - More advanced obfuscation methods may be preferred for better concealment.

## Advanced Obfuscation
### Notes
- Basic obfuscation still contains cleartext strings.
- Visible strings may reveal the original functionality of the code.
- Advanced obfuscation tools aim to completely hide the code’s purpose, including removing or disguising any cleartext elements.

Obfuscator
- Online Tool: https://obfuscator.io/
- More obfuscated, and can't see any remnants of our original code
  - Used String Array Encoding: Base64, as example

More Obfuscation
- Can obfuscate JavaScript code using tools like JSF and then rerun it to test functionality.
  - Link: http://www.jsfuck.com/
- Obfuscated code may take longer to run, highlighting how obfuscation can negatively affect performance.
- Other obfuscators: JJ Encode (https://utf-8.jp/public/jjencode.html) or AA Encode (https://utf-8.jp/public/aaencode.html)
  - Can make execution or compilation extremely slow, so they are generally not recommended unless there's a specific reason, such as:
    - Bypassing web filters
    - Evading restrictions

## Deobfuscation
### Notes
- If there are tools for obfuscation, then there are also tools for deobfuscation

Beautify
- To undo the effect of Minify, you can use Beautify from the Browser Dev Tools
- Other Tools: Prettier (https://prettier.io/playground/) and Beautifier (https://beautifier.io/)
- This only changes the format to make it easier to read, not undo the deeper obfuscation such as Packing 

Deobfuscate
- Other Tools: UnPacker (https://matthewfl.com/unPacker.html)
- Another way of unpacking obfuscated code is to find the return value at the end and use console.log to print it instead of executing it.

Reverse Engineering
- Basic obfuscation tools are effective at cleaning up simple obfuscated code.
- As code becomes more heavily obfuscated or encoded, especially with custom obfuscation tools, it becomes harder for automated tools to deobfuscate.
- In such advanced cases, manual reverse engineering is required to:
  - Understand how the code was obfuscated.
  - Determine the original functionality.
- For deeper learning, refer to the Secure Coding 101 module, which covers:
  - Advanced JavaScript deobfuscation
  - Reverse engineering techniques.

### Walkthrough
Q1. Using what you learned in this section, try to deobfuscate 'secret.js' in order to get the content of the flag. What is the flag?
- Visit the website: http://SERVER_IP:PORT
  - Replace the IP and Port with the one generated by HTB
- Open the source view of the page with 'Ctrl + U'
- Click on the secret.js to open the JS in another windows.
- Copy all the obfuscated JS code
- Open the online Unpacker tool
- Paste the code and deobfuscate
- Answer is in the variable 'flag'
- Answer is: HTB{1_4m_7h3_53r14l_g3n3r470r!}
